<!DOCTYPE html>
<html>
<head>
<title>风险状况</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport"
	content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<link rel="stylesheet"
	href="../../lib/jquery-mobile/jquery.mobile.min.css" />
<link rel="stylesheet" href="../../assets/jquery.mobile-sugon.css" />
<script src="../../lib/jquery/jquery.min.js"></script>
<script src="../../lib/jquery-cookie/jquery.cookie.js"></script>
<script src="../../lib/encrypt/encrypt.js"></script>
<script src="../../lib/json/json2.js"></script>
<script src="../../lib/hori/hori.js?tag=21369"></script>
<script src="../../lib/jquery-mobile/jquery.mobile.min.js"></script>
<script src="../../config/web/config.js"></script>
<script src="../../lib/knockout/knockout.js"></script>
<script src="../../lib/knockout/knockout.mapping.js"></script>
<style>
a {
	text-decoration: none;
}

#light_wall {
	padding: 0px;
	margin-left: 0px;
	float: left;
}

.top_year {
	font-size: 14px;
	position: fixed;
	color: #FFF;
	padding: 2px;
	background-color: rgba(127, 127, 127, 0.5);
}

.top_year_first {
	font-size: 14px;
	position: fixed;
	color: #FFF;
	padding: 2px;
	background-color: rgba(127, 127, 127, 0.5);
}

.big_light {
	width: 30px;
	height: 30px;
	margin-top: 12px;
}

.small_light {
	width: 12px;
	height: 12px;
}

@media only screen and (min-width: 1070px) and (max-width: 1242px) {
	#month {
		font-size: 17px;
	}
}

@media screen and (min-width: 400px) and (max-width: 800px) {
	#month {
		font-size: 16px;
	}
}

@media screen and (min-width: 310px) and (max-width: 330px) {
	#month {
		font-size: 15px;
	}
}

</style>
<script type="text/javascript">
	$(document).ready(function() {
		$.hori.setHeaderTitle("风险状况");
		//加载收入完成图表数据
		loadSrwcChart();
	});

	//加载收入完成图表数据
	function loadSrwcChart() {
		var url = $.hori.getconfig().appServerHost
				+ "view/bi/loadJytsChart/accsyBiReport/services/reqBiReportData";
		var temp = "$lt;?xml version='1.0' encoding='utf-8'?$gt;$lt;root$gt;$lt;reportdata$gt;$lt;reportid$gt;21$lt;/reportid$gt;$lt;/reportdata$gt;$lt;/root$gt;";
		var soap = "<soapenv:Envelope xmlns:soapenv='http://schemas.xmlsoap.org/soap/envelope/' xmlns:web='http://webservice.biz.digiwin.com'>";
		soap += '<soapenv:Header/><soapenv:Body>';
		soap += '<web:viewReportById>';
		soap += '<web:in0>' + temp + '</web:in0>';
		soap += '</web:viewReportById>';
		soap += ' </soapenv:Body></soapenv:Envelope>';
		var data = "data-xml=" + soap;
		var viewModel;

		$.hori
				.ajax({
					"type" : "post",
					"url" : url,
					"data" : data,
					"success" : function(res) {
						var json = JSON.parse(res);
						render(json);
						$("#month").css('display', '');
						var title = json.reportdata.title;
						var type = json.reportdata.type;
						var year = json.reportdata.year;
						//year = '2013';
						var month = json.reportdata.month;
						var monthdata = json.reportdata.monthData.split('|');

						var cWidth = window.screen.width;
						var monthWidth;
						var imgStringLiWidth;
						var imgStringWidth;
						var imgStringDivWidth;
						var imgwidth;
						var flag = -1;
						var tbImgWidth;//小图标宽度
						if (cWidth < 720) {
							monthWidth = "5.5%";
							imgStringLiWidth = "45px";
							imgStringDivWidth = "50px";
							imgStringWidth = "55px";
							imgwidth = "30px";
							tbImgWidth = "5.4%";
						} else {
							monthWidth = "5.7%";
							imgStringLiWidth = "50px";
							imgStringDivWidth = "50px";
							imgStringWidth = "60px";
							imgwidth = "40px";
							tbImgWidth = "5.6%";
						}
						var busiData = json.reportdata.busiData;
						//var imgString = '<div class="top_year_first" style="left: 193px; top: 6px;">2013</div>';
						var imgString = "<div > <span class='top_year_first'>"
								+ (year - 1)
								+ "</span>"
								+ "<span class='top_year'>"
								+ year
								+ "</span>"
								+ "</div><ul style='padding:10px;list-style:none;'><li><div style='float:left;width:"+imgStringLiWidth+";'>&nbsp;</div><div style='float:left;width:"+imgStringDivWidth+";'>&nbsp;</div>";

						/* var monthdata1 = new Array("5月", "6月", "7月", "8月",
								"9月", "10月", "11月", "12月", "1月", "2月", "3月",
								"4月", "");
						monthdata = monthdata1; */
						for (var z = 0; z < monthdata.length; z++) {
							if (monthdata[z].indexOf("1月") != -1
									&& monthdata[z].length == 2) { //包含1月，添加id处理
								flag = -1;
								imgString = imgString
										+ "<div id='targetMonth' style='float:left;width:"+monthWidth+";background-color:#00FFFF;'>"
										+ monthdata[z] + "</div>";
							} else if (z == 0) {
								imgString = imgString
										+ "<div id='firstMonth' style='float:left;width:"+monthWidth+";background-color:#00FF00'>"
										+ monthdata[z] + "</div>";
								flag = 1;
							} else if (flag > 0) {
								flag = flag + 1;
								imgString = imgString
										+ "<div style='float:left;width:"+monthWidth+";background-color:#00FF00;'>"
										+ monthdata[z] + "</div>";
							} else {
								imgString = imgString
										+ "<div style='float:left;width:"+monthWidth+";background-color:#00FFFF;'>"
										+ monthdata[z] + "</div>";
							}
						}

						imgString = imgString + "</li><br/>"
						for (var i = 0; i < busiData.length; i++) {
							var busiName = busiData[i].busiName;
							if (busiName != '证券投资') {
								if (30 == busiData[i].now) {
									imgString = imgString
											+ "<li style='line-height:50px;'><div style='float:left;clear:both;width:"+imgStringWidth+";min-width:65px;'>"
											+ busiName
											+ "</div><div style='float:left;width:"+imgwidth+";'><img src='img/dahong.png' class='big_light'/></div>"
								} else {
									imgString = imgString
											+ "<li style='line-height:50px;'><div style='float:left;clear:both;width:"+imgStringWidth+";min-width:65px;'>"
											+ busiName
											+ "</div><div style='float:left;width:"+imgwidth+";'><img src='img/dalv.png' class='big_light'/></div>"
								}
								var imageType = busiData[i].imageType
										.split('|');
								for (var j = 0; j < imageType.length - 1; j++) {
									if (10 == imageType[j]) {
										imgString = imgString
												+ "<div style='float:left;width:"+tbImgWidth+";line-height:50px;'><img src='img/xiaolv.png' class='small_light'/></div>";
									} else if (20 == imageType[j]) {
										imgString = imgString
												+ "<div style='float:left;width:"+tbImgWidth+";line-height:50px;'><img src='img/xiaohuang.png' class='small_light'/></div>";
									} else if (30 == imageType[j]) {
										imgString = imgString
												+ "<div style='float:left;width:"+tbImgWidth+";line-height:50px;'><img src='img/xiaohong.png' class='small_light'/></div>";
									} else {
										imgString = imgString
												+ "<div style='float:left;width:"+tbImgWidth+";line-height:50px;'><img src='img/xiaohui.png' class='small_light'/></div>";
									}
								}
								imgString = imgString + "</li>";
							}
						}
						imgString = imgString + "</ul>";
						document.getElementById("light_wall").innerHTML = imgString;
						//显示顶部年份
						changeTipYearPosition(year, monthdata);
					},
					"error" : function(res) {
						alert("error:" + res);
						$.hori.hideLoading();
					}
				});
		function render(parsedStr) {
			viewModel = ko.mapping.fromJS(parsedStr);
			ko.applyBindings(viewModel, document.getElementById('month'));
		}
	}

	//显示顶部年份
	function changeTipYearPosition(year, monthdata) {
		//1月份显示div对象
		var targetMonth = document.getElementById("targetMonth");
		var firstMonth = document.getElementById("firstMonth");
		if (targetMonth) {
			var x = targetMonth.offsetLeft - 5;
			var y = targetMonth.offsetTop - 20;
			$(".top_year").css("left", x + 'px');
			$(".top_year").css("top", y + 'px');
		}

		if (firstMonth) {
			x = firstMonth.offsetLeft - 5;
			y = firstMonth.offsetTop - 20;
			$(".top_year_first").css("left", x + 'px');
			$(".top_year_first").css("top", y + 'px');
		}

		var currentYear = new Date().getFullYear();
		if (year == currentYear) {
			if (monthdata[0] == '1月') {
				$('.top_year_first').css('display', 'none');
			} else {
				if (targetMonth) {
					var x = targetMonth.offsetLeft;
					var y = targetMonth.offsetTop - 20;
					var index = monthdata.indexOf('1月');
					/* var a=(11 - index) * monthWidth + x;alert(a);
					 */
					var a = $('#targetMonth').css('width');
					a = a.slice(0, 2);
					a = (11 - index) * parseInt(a) + x-5;
					$(".top_year").css("left", a + 'px');

				}
			}
		} else {
			$('.top_year_first').css('display', 'none');
		}
	}
	//声明slidingScreen变量判断禁止滑动
	var slidingScreen = "no";
	document.addEventListener("touchmove", function(e) {
		if (slidingScreen == "no") {
			e.preventDefault();
			e.stopPropagation();
		}
	}, false);
</script>
</head>
<body onmousewheel="return false;">
	<div id='month' style="float: right; display: none; ">
		注：此经营数据截至<span data-bind="text: reportdata.year"></span>年<span
			data-bind="text: reportdata.month"></span>月。
	</div>
	<div style="min-width:100%; height: 50px;"></div>
	<!-- 风险状况 -->
	<div id="light_wall"></div>
</body>
</html>
