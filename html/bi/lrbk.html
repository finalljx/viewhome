<!DOCTYPE html>
<html>
<head>
<title>利润板块</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1.0" />
<link rel="stylesheet"
	href="../../lib/jquery-mobile/jquery.mobile.min.css" />
<script src="../../lib/jquery/jquery.min.js"></script>
<script src="../../lib/jquery-cookie/jquery.cookie.js"></script>
<script src="../../lib/encrypt/encrypt.js"></script>
<script src="../../lib/json/json2.js"></script>
<script src="../../lib/hori/hori.js?tag=21369"></script>
<script src="../../lib/jquery-mobile/jquery.mobile.min.js"></script>
<script src="../asset/js/echarts-plain.js"></script>
<script src="../../config/web/config.js"></script>
<script src="../../lib/knockout/knockout.js"></script>
<script src="../../lib/knockout/knockout.mapping.js"></script>
<style>
a {
	text-decoration: none;
}

@media only screen and (min-width: 1070px) and (max-width: 1242px) {
	#month {
		font-size: 17px;
	}
}

@media screen and (min-width: 400px) and (max-width: 800px) {
	#month {
		font-size: 16px;
	}
}

@media screen and (min-width: 310px) and (max-width: 330px) {
	#month {
		font-size: 15px;
	}
}
</style>

</head>
<body>
	<div id='month'
		style="float: right; display: none; margin-bottom: 15px;">
		注：此经营数据截至<span data-bind="text: reportdata.year"></span>年<span
			data-bind="text: reportdata.month"></span>月。
	</div>
	<!-- 利润板块-->
	<div id="main" style="height: 400px; margin-top: 20px;"></div>
	<script type="text/javascript">
		$(document).ready(function() {
			$.hori.setHeaderTitle("利润板块");
			var h = (document.documentElement.clientHeight);//可见区域高度
			var w = document.documentElement.clientWidth;//可见区域高度
			var sm = document.getElementById('main');
			//h= parseInt(h)-5;
			sm.style.height = h + "px";
			sm.style.width = w + "px";
			//加载利润板块图表数据
			loadLrbkChart();
		});

		//加载利润板块图表数据
		function loadLrbkChart() {
			$.hori.loading();
			var url = $.hori.getconfig().appServerHost
					+ "view/bi/loadJytsChart/accsyBiReport/services/reqBiReportData";
			var temp = "$lt;?xml version='1.0' encoding='utf-8'?$gt;$lt;root$gt;$lt;reportdata$gt;$lt;reportid$gt;36$lt;/reportid$gt;$lt;/reportdata$gt;$lt;/root$gt;";
			var soap = "<soapenv:Envelope xmlns:soapenv='http://schemas.xmlsoap.org/soap/envelope/' xmlns:web='http://webservice.biz.digiwin.com'>";
			soap += '<soapenv:Header/><soapenv:Body>';
			soap += '<web:viewReportById>';
			soap += '<web:in0>' + temp + '</web:in0>';
			soap += '</web:viewReportById>';
			soap += ' </soapenv:Body></soapenv:Envelope>';
			var data = "data-xml=" + soap;
			var viewModel;

			$.hori.ajax({
				"type" : "post",
				"url" : url,
				"data" : data,
				"success" : function(res) {
					var cWidth = window.screen.width;
					var fontSize;
					if (cWidth < 720) {
						fontSize = 15;
					} else {
						fontSize = 18;
					}
					console.log(res);
					var json = JSON.parse(res);
					render(json);
					$("#month").css('display', '');
					var reportdata = json.reportdata;
					var title = reportdata.title;
					var year = reportdata.year;
					var month = reportdata.month;
					var primaryunit = reportdata.primaryunit;
					var category = reportdata.category.split('|');
					var seriesdata = reportdata.seriesdata.split('|');
					loadlrbk(title, year, month, primaryunit, category,
							seriesdata, fontSize);
					$.hori.loading("hide");
				},
				"error" : function(res) {
					alert("error:" + res);
					$.hori.loading("hide");
					$.hori.hideLoading();
				}
			});
		}
		function render(parsedStr) {
			viewModel = ko.mapping.fromJS(parsedStr);
			ko.applyBindings(viewModel, document.getElementById('month'));
		}
		function loadlrbk(title, year, month, primaryunit, category,
				seriesdata, fontSize) {
			var option = {
				animation : false,
				tooltip : {
					trigger : 'item',
					formatter : "{b} <br/> {c} ({d}%)"
				},
				color : [ '#e40218', '#fdf001', '#b5c606', '#32cd32',
						'#76c7c0', '#1596ab', '#e98434', '#409736', '#ff6600',
						'#40e0d0', '#1e90ff', '#ff6347', '#7b68ee', '#00fa9a',
						'#ffd700', '#6699FF', '#ff6666', '#3cb371', '#b8860b',
						'#30e0e0' ],
				legend : {
					data : category,
					x : 'left',
					margin : 200,
					selectedMode : false,
					// 主题，主题
					textStyle : {
						fontSize : fontSize
					}
				},

				toolbox : {
					show : false
				},
				series : [ {
					itemStyle : {
						normal : {
							label : {
								position : 'outer',
								formatter : '{d}%'
							},
						}
					},
					name : title,
					type : 'pie',
					center : [ '50%', '50%' ],
					radius : '50%',
					data : [ {
						value : seriesdata[0],
						name : category[0]
					}, {
						value : seriesdata[1],
						name : category[1]
					}, {
						value : seriesdata[2],
						name : category[2]
					}, {
						value : seriesdata[3],
						name : category[3]
					}, {
						value : seriesdata[4],
						name : category[4]
					}, {
						value : seriesdata[5],
						name : category[5]
					}, {
						value : seriesdata[6],
						name : category[6]
					}, {
						value : seriesdata[7],
						name : category[7]
					}

					]
				} ]
			};
			var myChart = echarts.init(document.getElementById('main'));
			myChart.setOption(option);
		}
	</script>
</body>
</html>
