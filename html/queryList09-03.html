<html>
<head>
	<title>请示审批</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1.0"/>
	<script type="application/javascript" src="../assets/iscroll.js"></script>
	<link rel="stylesheet" href="../lib/jquery-mobile/jquery.mobile-latest/jquery.mobile.min.css" /> 
	<link rel="stylesheet" href="../assets/jquery.mobile-sugon.css" /> 
	<script src="../lib/jquery/jquery.min.js"></script>		
	<script src="../lib/encrypt/encrypt.js"></script>
	<script src="../lib/json/json2.js"></script>
	<script src="../lib/hori/hori.js?tag=21369"></script>
	<script src="../config/web/config.js"></script>
	<script src="../lib/jquery-mobile/jquery.mobile-latest/jquery.mobile.min.js"></script>
	<script type="text/javascript">
			var myScroll,pullUpEl, pullUpOffset,generatedCount=0;
			var Astart=1;
			var Bstart=1;
			var Cstart=1;
			function pullUpAction () {
				setTimeout(function () {
					//vwDocByDate,vwtoArchive,vwDocByArchvied
					var view = localStorage.getItem("type");
					var dbpath = localStorage.getItem("dbpath");
					if(view=="vwDocByDate"){
						template="queryForDoing";
						Astart=Astart+20;
						start=Astart;
					}
					if(view=="vwtoArchive"){
						template="toArchive";
						Bstart=Bstart+20;
						start=Bstart;
					}
					if(view=="vwDocByArchvied"){
						template="Archvied";
						Cstart=Cstart+20;
						start=Cstart;
					}
					
					var url=$.hori.getconfig().appServerHost+"view/oa/"+template+"/docapp/"+dbpath+"/myview?openform&view="+view+"&start="+start+"&count=20";
					$.hori.ajax({
						"type":"post",
						"url":url,
						"success":function(res){
							$("#moredata").remove();
							$("#querydataList").append(res).listview("refresh");
							myStartTaskLoad=true;
						},
						"error":function(res){
							alert(res);
							$.hori.hideLoading();
						}
					});
					myScroll.refresh();
				}, 1000);
			}
			function loaded() {
				pullUpEl = document.getElementById('pullUp');	
				pullUpOffset = pullUpEl.offsetHeight;
				
			myScroll = new iScroll('wrapper', {
				useTransition: true,
				topOffset: pullUpOffset,
				onRefresh: function () {
				if (pullUpEl.className.match('loading')) {
						pullUpEl.className = '';
						pullUpEl.querySelector('.pullUpLabel').innerHTML = '';
					}
				},
			onScrollMove: function () {
				if (this.y < (this.maxScrollY - 5) && !pullUpEl.className.match('flip')) {
					pullUpEl.className = 'flip';
					pullUpEl.querySelector('.pullUpLabel').innerHTML = '';
					this.maxScrollY = this.maxScrollY;
				} else if (this.y > (this.maxScrollY + 5) && pullUpEl.className.match('flip')) {
					pullUpEl.className = '';
					pullUpEl.querySelector('.pullUpLabel').innerHTML = '';
					this.maxScrollY = pullUpOffset;
				}
			},
			onScrollEnd: function () {
				if (pullUpEl.className.match('flip')) {
					pullUpEl.className = 'loading';
					pullUpEl.querySelector('.pullUpLabel').innerHTML = '';
					pullUpAction();
				}
			}
		});
			setTimeout(function () { document.getElementById('wrapper').style.left = '0'; }, 800);
		}
			document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
			document.addEventListener('DOMContentLoaded', function () { setTimeout(loaded, 200); }, false);
</script>
	<script>
		var myStartTaskLoad=false;
		var myDoingTaskLoad=false;
		var singdbPath ="";
		$(document).ready(function(){
			var hori = $.hori;
			/*设置标题*/
			hori.setHeaderTitle("任务");
			$("#tabs").tabs({beforeActivate:function(event,ui){
					//alert(ui.newTab.context.dataset.id);
					var tabid=ui.newTab.context.dataset.id;
					//内请
					if(tabid=="queryList" && !myDoingTaskLoad){
						//queryListForDoing();
					}
					//会签
					if(tabid=="signList" && !myStartTaskLoad){
						//signListForDoing();
					}
			}})
			var onlist=localStorage.getItem("click");
			//alert(onlist);
			if(onlist=="1"){
				$("#ui-id-1").click()	
			}
			if(onlist=="2"){
				$("#ui-id-2").click()	
			}
			hori.registerEvent("case", "casePresented", function() {
				var onlist=localStorage.getItem("click");
				if(onlist=="1"){
					$("#ui-id-1").click()	
				}
				if(onlist=="2"){
					$("#ui-id-2").click()	
				}
			});
			queryListForDoing();
			//getsignpath();
			
		})
		</script>
		<script type="text/javascript">
		
		//内请办理中
		function queryListForDoing(){
			localStorage.setItem("type","vwDocByDate");
			var dbpath="genertec/dep1/qsbg_1.nsf";
			localStorage.setItem("dbpath","genertec/dep1/qsbg_1.nsf");
			var url=$.hori.getconfig().appServerHost+"view/oa/queryForDoing/docapp/"+dbpath+"/myview?openform&view=vwDocByDate&start=1&count=20";
			$.hori.ajax({
				"type":"post",
				"url":url,
				"success":function(res){
					console.log(res);
					$("#querydataList").empty();
					$("#querydataList").append(res).listview("refresh");
					myStartTaskLoad=true;
				},
				"error":function(res){
					alert(res);
					$.hori.hideLoading();
				}
			});
		}
		//内请切换
		var template = "";
		function queryListForType(view){
			//vwDocByDate,vwtoArchive,vwDocByArchvied
			Astart=1;Bstart=1;Cstart=1;
			if(view=="vwDocByDate"){
				template="queryForDoing";
			}
			if(view=="vwtoArchive"){
				template="toArchive";
			}
			if(view=="vwDocByArchvied"){
				template="Archvied";
			}
			localStorage.setItem("type",view);
			localStorage.setItem("dbpath","genertec/dep1/qsbg_1.nsf");
			var url=$.hori.getconfig().appServerHost+"view/oa/"+template+"/docapp/genertec/dep1/qsbg_1.nsf/myview?openform&view="+view+"&start=1&count=20";
			$.hori.ajax({
				"type":"post",
				"url":url,
				"success":function(res){
					console.log(res);
					$("#querydataList").empty();
					$("#querydataList").append(res).listview("refresh");
					myStartTaskLoad=true;
				},
				"error":function(res){
					alert(res);
					$.hori.hideLoading();
				}
			});
		}
		//内请表单展示页面
		function loadPageForm(str){
		////vwDocByDate,vwtoArchive,vwDocByArchvied
			var template ="querycontent";
			var unid = $(str).data("unid");
			var type = localStorage.getItem("type");
			var loadurl= $.hori.getconfig().appServerHost+"view/oa/"+template+"/docapp/genertec/dep1/qsbg_1.nsf/"+type+"/"+unid+"?editdocument";
			$.hori.loadPage(loadurl);
		}
		//获取会签类型库
		function getsignpath(){
			$.hori.ajax({
				"type":"post",
				"url":"/viewhome/oa/signtype/docapp/genertec/mgrengine.nsf/createNavigator?openAgent&divIndex=001",
				"success":function(res){
					localStorage.setItem("singdbPath",res);
					console.log(res);
					//docapp/genertec/dep26/hqk_26.nsf
					//用于测试写死，正式时要放开
					//singdbPath = res;
					singdbPath="/docapp/genertec/dep251/hqk_251.nsf";
					signListForDoing();
					
				},
				"error":function(res){
				}
			});
		}
		//会签办理中 
		function signListForDoing(){
			localStorage.setItem("type","signvwDocByDate");
			var dbpath=singdbPath;
			localStorage.setItem("dbpath",dbpath);
			var url=$.hori.getconfig().appServerHost+"view/oa/signForDoing"+dbpath+"/myview?openform&view=vwDocByDate&start=1&count=20";
			$.hori.ajax({
				"type":"post",
				"url":url,
				"success":function(res){
					$("#signdataList").empty();
					$("#signdataList").append(res).listview("refresh");
					myStartTaskLoad=true;
				},
				"error":function(res){
					alert(res);
					$.hori.hideLoading();
				}
			});
		}
		
	</script>
	
</head>
<body>
	<div data-role="page" style="margin:0px;padding:0px;">
		<div data-role="content">
			<div data-role="tabs" id="tabs">
		      	<div data-role="navbar">
				    <ul>
				      <li><a href="#two" data-ajax="false" data-id="queryList">内请</a></li>
				      <li><a href="#three" data-ajax="false" data-id="signList">会签</a></li>
				    </ul>
		      	</div>
			      <div id="two">
					<div align="center" class="ui-grid-b">
						<div class="ui-block-a">
							<select name="querytype" id="querytype" onChange="queryListForType(this.value)" data-theme="a"  data-native-menu="true">
							<option value="vwDocByDate">办理中</option>
							<option value="vwtoArchive">待归档</option>
							<option value="vwDocByArchvied">已归档</option>
							</select>
						</div>
						<div class="ui-block-b"></div>
						<div class="ui-block-c"></div>
					</div>
			      	<div id="wrapper">
					<div id="scroller">
						<div id="pullDown">
						</div>
						<ul id="querydataList"  data-role="listview" data-inset="true">
							
							<li id="moredata" style="display:none"><div id="pullUp" align="center">
								<span class="pullUpLabel">上划加载更多...</span>
							</div></li>
						</ul>
					</div>
					</div>
			      </div>
			      <div id="three">
					<div align="center" class="ui-grid-b">
						<div class="ui-block-a"></div>
						<div class="ui-block-b"></div>
						<div class="ui-block-c">
							<select name="signtype" id="signtype" data-theme="a"  data-native-menu="true">
								<option value="Application/ykzh/DigiFlowIssueDoc.nsf">办理中</option>
								<option value="Application/ykzh/DigiFlowReceiveDoc.nsf">待归档</option>
								<option value="Application/ykzh/DigiFlowReceiveDoc.nsf">已归档</option>
							</select>
						</div>
					</div>
			       <ul id="signdataList" data-role="listview" data-inset="true">
					
				   </ul>
			      </div>
		    </div>
		</div>	
		<br/><br/><br/>
	</div>		
</body>
	

</html>

