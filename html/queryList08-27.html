
<html>
<head>
	<title>请示审批</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1.0"/>
	<script type="application/javascript" src="../assets/iscroll.js"></script>
	<link rel="stylesheet" href="../lib/jquery-mobile/jquery.mobile-latest/jquery.mobile.min.css" /> 
	<link rel="stylesheet" href="../assets/jquery.mobile-sugon.css" /> 
	<script src="../lib/jquery/jquery.min.js"></script>		
	<script src="../lib/encrypt/encrypt.js"></script>
	<script src="../lib/json/json2.js"></script>
	<script src="../lib/hori/hori.js?tag=21369"></script>
	<script src="../config/web/config.js"></script>
	<script src="../lib/jquery-mobile/jquery.mobile-latest/jquery.mobile.min.js"></script>
	<script>
		var myStartTaskLoad=false;
		var myDoingTaskLoad=false;
		$(document).ready(function(){
			var hori = $.hori;
			/*设置标题*/
			hori.setHeaderTitle("任务");
			$("#tabs").tabs({beforeActivate:function(event,ui){
					//alert(ui.newTab.context.dataset.id);
					var tabid=ui.newTab.context.dataset.id;
					//内请
					if(tabid=="queryList" && !myDoingTaskLoad){
							queryListForDoing();
					}
					//会签
					if(tabid=="signList" && !myStartTaskLoad){
						signListForDoing();
					}
			}})
			var onlist=localStorage.getItem("click");
			//alert(onlist);
			if(onlist=="1"){
				$("#ui-id-1").click()	
			}
			if(onlist=="2"){
				$("#ui-id-2").click()	
			}
			hori.registerEvent("case", "casePresented", function() {
				var onlist=localStorage.getItem("click");
				if(onlist=="1"){
					$("#ui-id-1").click()	
				}
				if(onlist=="2"){
					$("#ui-id-2").click()	
				}
			});
			queryListForDoing();
		})
		</script>
		<script type="text/javascript">
		
		//内请办理中
		function queryListForDoing(){
			var url=$.hori.getconfig().appServerHost+"view/oa/queryForDoing/docapp/genertec/dep1/qsbg_1.nsf/myview?openform&view=vwDocByDate&start=1&count=10";
				$.hori.ajax({
					"type":"post",
					"url":url,
					"success":function(res){
						console.log(res);
						$("#querydataList").empty();
						$("#querydataList").append(res).listview("refresh");
						myStartTaskLoad=true;
						$("#signdataList").empty();
					},
					"error":function(res){
						alert(res);
						$.hori.hideLoading();

						
					}
				});
		}
		//内请办理中/docapp/genertec/dep1/qsbg_1.nsf/myview?openform&view=vwDocByDate&start=1&count=50
		//内请待归档/docapp/genertec/dep1/qsbg_1.nsf/myview?openform&view=vwtoArchive&start=1&count=20
		//内请已归档/docapp/genertec/dep1/qsbg_1.nsf/myview?openform&view=vwDocByArchvied&start=1&count=20
		function queryListForType(view){
			var url=$.hori.getconfig().appServerHost+"view/oa/queryForDoing/docapp/genertec/dep1/qsbg_1.nsf/myview?openform&view="+view+"&start=1&count=10";
				$.hori.ajax({
					"type":"post",
					"url":url,
					"success":function(res){
						console.log(res);
						$("#querydataList").empty();
						$("#querydataList").append(res).listview("refresh");
						myStartTaskLoad=true;
						$("#signdataList").empty();
					},
					"error":function(res){
						alert(res);
						$.hori.hideLoading();

						
					}
				});
		}

			//会签办理中
			function signListForDoing(){
				alert("会签办理中");return;
				var itcode=localStorage.getItem("itcode");
				var url=$.hori.getconfig().appServerHost+"view/oatask/getDoingTask/Produce/DigiFlowMobile.nsf/agGetViewData?openagent?login&server=&dbpath=TMS/TaskIndex.nsf&view=VDocIndexByZxrViewForMobile&thclass="+itcode+"$&page=1&count=10 ";
					$.hori.ajax({
						"type":"post",
						"url":url,
						"data":"",
						"success":function(res){
							
							$("#myDoingTaskList").empty();
							console.log(res);
							myDoingTaskLoad=true;
							$("#myDoingTaskList").append(res).listview("refresh");
							var num = $("#num").text();
							$("#task").text(num);
						},
						"error":function(res){
							alert(res);
							$.hori.hideLoading();
						}
					});
			}
			function test(val){
				alert(val);
			}
	</script>
	<style>

	#open{
		background-color: #38c;
		border-color: #38c;
		color: #fff;
		text-shadow: 0 1px 0 #059;

		-webkit-border-radius: 30px;
		-moz-border-radius: 30px;
		border-radius: 30px;
		-webkit-box-shadow: 1px 1px 1px rgba(0,0,0, .29), inset 1px 1px 1px rgba(255,255,255, .44);
		-moz-box-shadow: 1px 1px 1px rgba(0,0,0, .29), inset 1px 1px 1px rgba(255,255,255, .44);
		box-shadow: 1px 1px 1px rgba(0,0,0, .29), inset 1px 1px 1px rgba(255,255,255, .44);
		-webkit-transition: all 0.15s ease;
		-moz-transition: all 0.15s ease;
		-o-transition: all 0.15s ease;
		-ms-transition: all 0.15s ease;
		transition: all 0.15s ease;

	}
	</style>

</head>
<body>
	<div data-role="page" style="margin:0px;padding:0px;">
		<div data-role="content">
			<div data-role="tabs" id="tabs">
		      	<div data-role="navbar">
				    <ul>
				      <li><a href="#two" data-ajax="false" data-id="queryList">内请</a></li>
				      <li><a href="#three" data-ajax="false" data-id="signList">会签</a></li>
				    </ul>
		      	</div>
			      <div id="two">
					<div align="center" class="ui-grid-b">
						<div class="ui-block-a">
							<select name="querytype" id="querytype" onChange="queryListForType(this.value)" data-theme="a"  data-native-menu="true">
							<option value="vwDocByDate">办理中</option>
							<option value="vwtoArchive">待归档</option>
							<option value="vwDocByArchvied">已归档</option>
							</select>
						</div>
						<div class="ui-block-b"></div>
						<div class="ui-block-c"></div>
					</div>
			      	<ul id="querydataList"  data-role="listview" data-inset="true"></ul>
			      </div>
			      <div id="three">
					<div align="center" class="ui-grid-b">
						<div class="ui-block-a"></div>
						<div class="ui-block-b"></div>
						<div class="ui-block-c">
							<select name="signtype" id="signtype" data-theme="a"  data-native-menu="true">
								<option value="Application/ykzh/DigiFlowIssueDoc.nsf">办理中</option>
								<option value="Application/ykzh/DigiFlowReceiveDoc.nsf">待归档</option>
								<option value="Application/ykzh/DigiFlowReceiveDoc.nsf">已归档</option>
							</select>
						</div>
					</div>
			       <ul id="signdataList" data-role="listview" data-inset="true"></ul>
			      </div>
		    </div>
		</div>	
		<br/><br/><br/>
	</div>		
</body>
	

</html>

