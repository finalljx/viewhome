<!DOCTYPE html>
<html>
<head>
<title>重置密码</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1.0" />
<link rel="stylesheet" href="../lib/jquery-mobile/jquery.mobile.min.css" />
<link rel="stylesheet" href="../assets/jquery.mobile-sugon.css" />
<script src="../lib/jquery/jquery.min.js"></script>
<script src="../lib/jquery-cookie/jquery.cookie.js"></script>
<script src="../lib/encrypt/encrypt.js"></script>
<script src="../lib/json/json2.js"></script>
<script src="../lib/hori/hori.js?tag=21369"></script>
<script src="../lib/jquery-mobile/jquery.mobile.min.js"></script>
<script src="../config/web/config.js"></script>
<style>
a {
	text-decoration: none;
}
</style>
<script type="text/javascript">
	$(document).ready(function() {
		var hori = $.hori;
		try {
			hori.setHeaderTitle("忘记密码");
			/*隐藏后退按钮*/
			//hori.hideBackBtn();
		} catch (e) {
			alert(e.message);
		}
	});

	//获取验证码
	function getCaptcha() {
		var un_name = $.trim($("#cn_name").val());
		var username = $.trim($("#user_name").val());
		var number = $("#id_number").val();
		if (username == "") {
			alert("请输入用户名!");
			return;
		}
		if (un_name == "") {
			alert("请输入姓名!");
			return;
		}
		if (number == "") {
			alert("请输入身份证号!");
			return;
		}
		var url = $.hori.getconfig().appServerHost + "view/forgetpwd/sendSms/resetPWsendSMS?data-result=text";
		$.hori.ajax({
			"type" : "get",
			"url" : url,
			"data" : $('#forgetPwdForm').serialize(),
			"success" : function(res) {
			    //alert("res1=="+res);
			    console.log("res0=="+res);
			},
			"error" : function(res) {
				alert(res);
				$.hori.hideLoading();
			}
		})
	}
	function reset() {
		var un_name = $.trim($("#cn_name").val());
		var username = $.trim($("#user_name").val());
		var number = $("#id_number").val();
		if (username == "") {
			alert("请输入账号!");
			return;
		}
		if (un_name == "") {
			alert("请输入姓名!");
			return;
		}
		if (number == "") {
			alert("请输入身份证号!");
			return;
		}
		$.hori.showLoading();
		try {
			/* document.getElementById("mobile_number").value="12345678909";
			document.getElementById("imageCode").value="1231"; */
			var random = new Date().getTime();
			var url = $.hori.getconfig().appServerHost
					+ "view/forgetpwd/resetSubmit/resetPWsubmit?data-result=text";
			url = url + "&data-random=" + random;
			
		} catch (e) {
		}
		$.hori.ajax({
			"type" : "get",
			"url" : url,
			"data" :  $("#forgetPwdForm").serialize(),
			"success" : function(res) {
				console.log("res2=="+res);
				var a= JSON.parse(res);
			    if(a.rtn_code == 2000)
					$("#div_hidden").css("display", "block");
				else
					alert(a.rtn_msg); 
			},
			"error" : function(res) {
				alert(res + "222");
				$.hori.hideLoading();
			}
		})
	}
</script>
</head>
<body>
	<!-- 登录页面 -->
	<div data-role="page" id="login" class="login">
		<div data-role="content" align="center">
			<form id="forgetPwdForm">
				<ul id="viewBody" data-role="listview" data-theme="c"
					data-inset="true" style="max-width: 400px;">
					<li data-role="list-divider"><a href="javascript:void(0);"
						data-theme="f"></a></li>
					<li data-role="fieldcontain" data-type="horizontal">
						<table style="width: 100%" cellspaceing="0" cellpadding="0"
							border="0">
							<tr>
								<td><strong>用&#160;&#160;户&#160;&#160;名:</strong>
								</td>
								<td><input type="hidden" id="okey" name="okey" value="Fwad1Zfv8XnXHoEDkOjSX2XldzwNnG72"/>
								<input type="hidden" id="mobile_number" name="mobile_number" value=""/>
								<input type="text" name="user_name"
									style="outline: none; width: 100%; border: 0; background: transparent;"
									id="user_name" value="geyuxi" onfocus="clearData()"
									onblur="showTips()" /></td>
							</tr>
						</table>
					</li>
					<li data-role="fieldcontain">
						<table style="width: 100%" cellspaceing="0" cellpadding="0"
							border="0">
							<tr>
								<td><strong>姓&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;名:</strong>
								</td>
								<td><input type="text" name="cn_name"
									style="outline: none; width: 100%; border: 0; background: transparent;"
									id="cn_name" value="葛玉喜" /></td>
							</tr>
						</table>
					</li>
					<li data-role="fieldcontain">
						<table style="width: 100%" cellspaceing="0" cellpadding="0"
							border="0">
							<tr>
								<td><strong>身份证号:</strong></td>
								<td><input type="text" name="id_number"
									style="outline: none; width: 100%; border: 0; background: transparent;"
									id="id_number" value="220882198401195538" /></td>
							</tr>
						</table>
					</li>
					<li data-role="fieldcontain">
						<table style="width: 100%" cellspaceing="0" cellpadding="0"
							border="0">
							<tr>
								<td><strong>验&#160;&#160;证&#160;&#160;码:</strong></td>
								<td><input type="text" name="imageCode" id="imageCode"
									style="width: 80px;" /></td>
								<td><a data-role="button" href="javascript:void(0)"
									data-theme="f" data-mini="true" onclick="getCaptcha();">获取验证码</a>
								</td>
							</tr>
						</table>
					</li>
				</ul>
			</form><br/><br/>
			<div style="max-width: 250px;">
					<a href="javascript:void(0)" onclick="reset()" data-theme="f"
						data-role="button" data-icon="false">重置密码</a>
			</div>
			
			<div
				style="max-width: 400px; background-color: #ADADAD; display: none;" id="div_hidden"
				border="1px">
				<p>密码重置成功，新密码已发送到188****8890
			</div>


		</div>
	</div>
</body>
</html>
