<!DOCTYPE html>
<html>
<head>
<title>重置密码</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1.0" />
<link rel="stylesheet" href="../lib/jquery-mobile/jquery.mobile.min.css" />
<link rel="stylesheet" href="../assets/jquery.mobile-sugon.css" />
<script src="../lib/jquery/jquery.min.js"></script>
<script src="../lib/jquery-cookie/jquery.cookie.js"></script>
<script src="../lib/encrypt/encrypt.js"></script>
<script src="../lib/json/json2.js"></script>
<script src="../lib/hori/hori.js?tag=21369"></script>
<script src="../lib/jquery-mobile/jquery.mobile.min.js"></script>
<script src="../config/web/config.js"></script>
<style>
a {
	text-decoration: none;
}
</style>
<script type="text/javascript">
	$(document).ready(function() {
		var hori = $.hori;
		try {
			hori.setHeaderTitle("重置密码");
			/*隐藏后退按钮*/
			hori.hideBackBtn();
		} catch (e) {
			alert(e.message);
		}
	});

	//获取验证码
	function getCaptcha() {
		var un_name = $.trim($("#cn_name").val());
		var username = $.trim($("#user_name").val());
		var number = $("#id_number").val();
		if (username == "") {
			alert("请输入账号!");
			return;
		}
		if (un_name == "") {
			alert("请输入姓名!");
			return;
		}
		if (number == "") {
			alert("请输入身份证号!");
			return;
		}
		var url = $.hori.getconfig().appServerHost + "view/forgetwd/loginvalidate1/resetPWsendSMS"
		$.hori.ajax({
			"type" : "get",
			"url" : url,
			"headers":{
				"Access-Control-Allow-Origin": true
			},
			"data" : $('#forgetPwdForm').serialize(),
			"success" : function(res) {
			    alert(res);
			},
			"error" : function(res) {
				alert(res + "222");
				$.hori.hideLoading();
			}
		})
	}
	function reset() {
		var un_name = $.trim($("#cn_name").val());
		var username = $.trim($("#user_name").val());
		var number = $("#id_number").val();
		if (username == "") {
			alert("请输入账号!");
			return;
		}
		if (un_name == "") {
			alert("请输入姓名!");
			return;
		}
		if (number == "") {
			alert("请输入身份证号!");
			return;
		}
		$.hori.showLoading();
		try {
			var random = new Date().getTime();
			var url = $.hori.getconfig().appServerHost
					+ "view/forgetwd/loginvalidate2/resetPWsubmit";
			url = url + "?data-random=" + random;
		} catch (e) {
		}
		$.hori.ajax({
			"type" : "get",
			"url" : url,
			"data" :  $("#forgetPwdForm").serialize(),
			"success" : function(res) {
				alert(res);
			},
			"error" : function(res) {
				alert(res + "222");
				$.hori.hideLoading();
			}
		})
	}
	//查询用户信息方法
	function doSearch() {
		$.hori.showLoading();
		try {
			var random = new Date().getTime();
			var url = $.hori.getconfig().appServerHost
					+ "view/guide/getInfo/getUserinfo/";
			url = url + "?data-random=" + random + "&data-result=text";
		} catch (e) {
		}
		$.hori.ajax({
			"type" : "post",
			"url" : url,
			"data" : $("#forgetPwdForm").serialize(),
			"success" : function(res) {
				alert(res);
				var jdata = JSON.parse(res);
				document.getElementById("Mobile_number").value=jdata.mobile_number;
				reset();
				if (jdata.rtn_code && jdata.rtn_code == "2000") { //判断是否正确返回 
				} else { //未正确查询到结果
					alert(jdata.rtn_msg);
				}
			},
			"error" : function(res) {
				alert("查询失败：" + res);
				$.hori.hideLoading();
			}
		})
		
	}
</script>
</head>
<body>
	<!-- 登录页面 -->
	<div data-role="page" id="login" class="login">
		<div data-role="content" align="center">
			<form id="forgetPwdForm">
				<ul id="viewBody" data-role="listview" data-theme="c"
					data-inset="true" style="max-width: 400px;">
					<li data-role="list-divider"><a href="javascript:void(0);"
						data-theme="f"></a></li>
					<li data-role="fieldcontain" data-type="horizontal">
						<table style="width: 100%" cellspaceing="0" cellpadding="0"
							border="0">
							<tr>
								<td><strong>帐&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;号:</strong>
								</td>
								<td><input type="hidden" id="Okey" name="Okey" value="Fwad1Zfv8XnXHoEDkOjSX2XldzwNnG72"/>
								<input type="hidden" id="Mobile_number" name="Mobile_number" value=""/>
								<input type="text" name="user_name"
									style="outline: none; width: 100%; border: 0; background: transparent;"
									id="user_name" value="geyuxi" onfocus="clearData()"
									onblur="showTips()" /></td>
							</tr>
						</table>
					</li>
					<li data-role="fieldcontain">
						<table style="width: 100%" cellspaceing="0" cellpadding="0"
							border="0">
							<tr>
								<td><strong>姓&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;名:</strong>
								</td>
								<td><input type="text" name="cn_name"
									style="outline: none; width: 100%; border: 0; background: transparent;"
									id="cn_name" value="葛玉喜" /></td>
							</tr>
						</table>
					</li>
					<li data-role="fieldcontain">
						<table style="width: 100%" cellspaceing="0" cellpadding="0"
							border="0">
							<tr>
								<td><strong>身份证号:</strong></td>
								<td><input type="text" name="id_number"
									style="outline: none; width: 100%; border: 0; background: transparent;"
									id="id_number" value="220882198401195538" /></td>
							</tr>
						</table>
					</li>
					<li data-role="fieldcontain">
						<table style="width: 100%" cellspaceing="0" cellpadding="0"
							border="0">
							<tr>
								<td><strong>验证码&#160;&#160;&#160;&#160;:</strong></td>
								<td><input type="text" name="imageCode" id="imageCode"
									style="width: 80px;" /></td>
								<td><a data-role="button" href="javascript:void(0)"
									data-theme="f" data-mini="true" onclick="getCaptcha();">获取验证码</a>
								</td>
							</tr>
						</table>
					</li>
				</ul>
			</form><br/><br/>
			<div style="max-width: 250px;">
					<a href="javascript:void(0)" onclick="doSearch()" data-theme="f"
						data-role="button" data-icon="false">重置密码</a>
			</div>
			
			<div
				style="max-width: 400px; background-color: #ADADAD; display: none;"
				border="1px">
				<p>密码重置成功，新密码已发送到188****8890
			</div>


		</div>
	</div>
</body>
</html>
