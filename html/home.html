<html>
<head>
<title>首页</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1.0" />
<link rel="stylesheet" href="../lib/jquery-mobile/jquery.mobile.min.css" />
<link rel="stylesheet" href="../assets/jquery.mobile-sugon.css" />
<link rel="stylesheet" href="../lib/swiper/idangerous.swiper.css">
<link rel="stylesheet" href="../lib/app/home/css/news.css">
<style type="text/css">
.swiper-image {
	
}

.ui-li-has-count .ui-li-count {
	/* font-size: 16px; */
	font-weight: 700;
}

.ui-date-item {
	border: none;
	background: transparent;
	background-image: none;
	font-size: 2em;
}
</style>
<script src="../lib/jquery/jquery.min.js"></script>
<script src="../lib/jquery-cookie/jquery.cookie.js"></script>
<script src="../lib/encrypt/encrypt.js"></script>
<script src="../lib/json/json2.js"></script>
<script src="../lib/hori/hori.js?tag=21369"></script>
<script src="../lib/jquery-mobile/jquery.mobile.min.js"></script>
<script src="../lib/knockout/knockout.js"></script>
<script src="../lib/knockout/knockout.mapping.js"></script>
<script src="../lib/swiper/idangerous.swiper.min.js"></script>
<script src="../lib/app/home/app.js"></script>
<script src="../lib/app/home/news.js"></script>
<script src="../config/web/config.js"></script>
<style type="text/css">
.swiper-image {
	
}
</style>
<script type="text/javascript">
	var currentUser = "";
	$(document).ready(function() {
		try {
			var hori = $.hori;
			/*设置标题*/
			hori.setHeaderTitle("首页");
			/*隐藏后退按钮*/
			hori.hideBackBtn();
			/*注册注销事件*/
			hori.registerEvent("case", "navButtonTouchUp", function() {
				hori.backPage(1);
			});
			//ios 隐藏邮件图标
			createUser();
			var itcode = localStorage.getItem("itcode");
			//默认先加载图片新闻
			getNewsList(itcode, "GT_HomePage_SiteArea_tpxw", 6, 1);
			//加载通知公告
			getNewsList(itcode, "GT_HomePage_SiteArea_jttz", 4, 1);
			//加载集团新闻
			getNewsList(itcode, "GT_HomePage_SiteArea_jtxw", 4, 1);
			//成员单位新闻
			getNewsList(itcode, "GT_HomePage_SiteArea_zgsxw", 6, 1);
		} catch (e) {
			alert(e.message);
		}
	});
	//请示待办
	function loadTaskList() {
		$.hori.showLoading();
		localStorage.setItem("itcode", currentUser);
		var itcode = localStorage.getItem("itcode");
		$.hori
				.loadPage($.hori.getconfig().serverBaseUrl
						+ "viewhome/oa/todos/docapp/genertec/persontasks.nsf/dbview?openform&view=vwgwdbshow&restricttocategory="
						+ itcode + "&start=1&count=20");
	}
	//请示查阅
	function loadqueryList() {
		localStorage.setItem("click", "1");
		localStorage.setItem("addmore", "no");
		$.hori.showLoading();
		$.hori.loadPage($.hori.getconfig().serverBaseUrl
				+ 'viewhome/html/queryList.html');
	}
	//BI
	function loadBI() {
		$.hori.showLoading();
		$.hori.loadPage($.hori.getconfig().serverBaseUrl
				+ 'viewhome/html/bi.html');
	}
	function createUser() {
		$.hori
				.ajax({
					"type" : "get",
					"url" : "/viewhome/oa/currentuser/docapp/genertec/persontasks.nsf/frmPage?openform",
					"success" : function(res) {
						localStorage.setItem("Chinesename", res);
						currentUser = "CN=" + res + "/O=genertec";
					},
					"error" : function(res) {
					}
				});
	}
	//图片新闻
	function loadTpxwList() {
		$.hori.showLoading();
		$.hori.loadPage($.hori.getconfig().serverBaseUrl
				+ 'viewhome/html/news/tpxwList.html');
	}
	//集团新闻
	function loadNewsList(typeName) {
		localStorage.setItem("moreCurrentName", typeName);
		$.hori.showLoading();
		$.hori.loadPage($.hori.getconfig().serverBaseUrl
				+ 'viewhome/html/news/newsList.html');
	}

	//安全生产值班表列表
	function loadAqsczbb() {
		$.hori.showLoading();
		$.hori.loadPage($.hori.getconfig().serverBaseUrl
				+ 'viewhome/html/watchlist.html');
	}
</script>
</head>
<body>
	<div data-role="page" id="home"
		style="background: url(../assets/home/bg_empty.jpg); -moz-background-size: cover; background-repeat: repeat;">
		<div data-role="content" align="center">
			<div class="swiper-container">
				<div id="tpxwSwiper" class="swiper-wrapper"
					data-bind="foreach: list">
					<div class="swiper-slide">
						<a data-bind="click:showDetail"> <img
							data-bind="attr:{'src':tpxwImage}" />
							<div>
								<span class="title" data-bind="text: contentTitle"></span>
							</div>
						</a>
					</div>
				</div>
				<div class="pagination"></div>
				<div class="more">
					<a href="#" onclick="loadTpxwList();">more</a>
				</div>
			</div>
			<div class="ui-grid-b" id="divOne">
				<div class="ui-block-a">
					<a href="javascript:void(0);" onclick="loadTaskList()"> <img
						id="imgToDo" src="../assets/home/gwdb.png" class="module-icon" />
					</a> <br />
					<!-- <span id="spanTodo" class="bubble-count ui-btn-up-c ui-btn-corner-all">1</span> <br /> -->
					<span style="color: #434343;"><strong>公文待办</strong></span>
				</div>
				<div class="ui-block-b">
					<a href="javascript:void(0);" onclick="loadqueryList()"> <img
						id="imgSearch" class="module-icon" src="../assets/home/gwcy.png" />
					</a> <br />
					<!-- <span id="spanSearch" class="bubble-count ui-btn-up-c ui-btn-corner-all">1</span>  -->
					<span style="color: #434343;"><strong>公文查阅</strong></span>
				</div>
				<div class="ui-block-c" id="three" style="display: none">
					<a href="javascript:void(0);" onclick="loadBI()"> <img
						class="module-icon" src="../assets/home/bi.png">
					</a> <br /> <span style="color: #434343;"><strong>BI图表</strong></span>
				</div>
				<div class="ui-block-c">
					<a href="javascript:void(0);" onclick="loadAqsczbb()"> <img
						class="module-icon" src="../assets/home/aqsc.png">
					</a> <br /> <span style="color: #434343;"><strong>安全生产值班表</strong></span>
				</div>
			</div>
			<p>
			<div>
				<ul id="jttzList" data-role="listview" data-theme="d"
					data-bind="foreach: list">
					<li data-icon="false"><a data-bind="click:showDetailJttz">
							<!-- ko text: contentTitle --> <!-- /ko --> <span
							class="ui-li-count ui-date-item" data-bind="text:creatTime" />
					</a></li>
				</ul>
			</div>
			<p>
			<div>
				<ul id="jtxwList" data-role="listview" data-theme="d"
					style="word-wrap: break-word" data-bind="foreach: list">
					<li data-icon="false"><a data-bind="click:showDetailJttz">
							<!-- ko text: contentTitle --> <!-- /ko --> <span
							class="ui-li-count ui-date-item" data-bind="text:creatTime" />
					</a></li>
				</ul>
			</div>
			<p>
			<div>
				<ul id="cydwxwList" data-role="listview" data-theme="d"
					data-bind="foreach: list">
					<li data-icon="false"><a data-bind="click:showDetailJttz">
							<!-- ko text: contentTitle --> <!-- /ko --> <span
							class="ui-li-count ui-date-item" data-bind="text:creatTime" />
					</a></li>
				</ul>
			</div>

		</div>
	</div>

</body>
</html>
