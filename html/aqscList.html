<html class="ui-mobile">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1.0">

<link
	href="../lib/jquery-mobile/jquery.mobile-latest/jquery.mobile.min.css"
	rel="stylesheet"></link>
<link rel="stylesheet" href="../assets/jquery.mobile-sugon.css" />
<link href="../lib/jquery-mobile/jquery-mobile-fluid960.css"
	rel="stylesheet"></link>
<script type="application/javascript" src="../assets/iscroll.js"></script>
<script src="../lib/jquery/jquery.min.js"></script>
<script src="../lib/jquery-cookie/jquery.cookie.js"></script>
<script src="../lib/encrypt/encrypt.js"></script>
<script src="../lib/json/json2.js"></script>
<script src="../lib/hori/hori.js?tag=21369"></script>
<script src="../lib/arttemplate/template.js"></script>
<script
	src="../lib/jquery-mobile/jquery.mobile-latest/jquery.mobile.min.js"></script>
<script src="../config/web/config.js"></script>

<script>
	function doSearch() {
		$.hori.showLoading();
		try {
			var skey = $("#searchKey").val();

			if (skey == null || skey.length == 0) {
				alert("关键词不能为空");
				$.hori.hideLoading();  
				return;

			}
			//skey = encodeURI(skey);
			var random = new Date().getTime();
			var cookie_userstore = localStorage.getItem("cookie_userstore");
			var url = $.hori.getconfig().appServerHost
					+ "view/safety/watchList/Application/Safety/SafetyProBasic.nsf/SearchHolidayDutyForMobile?open";
			url = url + "&data-random=" + random + "&data-result=text";
		} catch (e) {
		}
		var data = 'key=' + skey;

		$.hori.ajax({
			"type" : "post",
			"url" : url,
			"data" : data,
			"success" : function(res) {
				var jsonData = new Object();
				var dataObj = JSON.parse(res);
				//json {"data":[{"DeptID":"1351","Date":"2013-12-23","StPsnCN":"史海","Dept":"中国仪器进出口(集团)公司","Holiday":"元旦"}]}
				if (dataObj.flag) {
					var html = template('watchlist', dataObj);
					$("#listContent").html(html);
				} else {
					alert(dataObj.flagMessage);
				}
				$.hori.hideLoading();
			},
			"error" : function(res) {
				alert(res);
				$.hori.hideLoading();
			}
		})
	}
	
	//跳转到详情页面
	 function loadListDetails(aElement) {
            $.hori.showLoading();
            var docunid=$(aElement).data("docunid");
            localStorage.setItem("watchDocUnid",docunid);
            //$.hori.loadPage($.hori.getconfig().serverBaseUrl + 'viewhome/html/listDetails_cbn.html');
            
            $("#rightContent").load("listDetailsForAQSC.html", function(a, b, c) {
        	});
        }
</script>

</head>
<style>
</style>
<body>

	<div style="margin-left: 15px;">
		<table>
			<tr>
				<td width="95%" height="20px"><input id="searchKey" type="text"
					value="中国邮电" /></td>
				<td><a href="#search" data-role="button" data-inline="true"
					onclick="doSearch()" data-rel="dialog" data-corners="true"
					data-shadow="true" data-iconshadow="true" data-wrapperels="span"
					data-theme="f"
					class="ui-btn ui-shadow ui-btn-corner-all ui-btn-inline ui-btn-up-c ui-btn-up-f">
						<span class="ui-btn-inner" style="width: 45px; height: 20px;"><span
							class="ui-btn-text" style="color: white">搜索</span></span>
				</a></td>
			</tr>
		</table>
	</div>

	<div data-role="content" id="listContent"></div>




	<script id="watchlist" type="text/html">
		<ul  data-role="listview" data-inset="true" class="ui-listview ui-listview-inset ui-corner-all ui-shadow">
			{{each data as rowObj i}}
			<li href="#" data-icon="false" class="ui-first-child ui-last-child">
				<a href="javascript:void(0)" data-docunid='{{rowObj["docunid"]}}' onclick="loadListDetails(this)" class="ui-btn">
					<h3 style="white-space: normal;"><span>{{rowObj["Dept"]}}</span></h3>
					<p style="font-size: 14px;line-height: 2em;"> 
						序号：<font color="#0080FF"> {{rowObj["DeptID"]}}</font>
						填报人：<font color="#0080FF"> {{rowObj["StPsnCN"]}}</font><br/>
						填报日期：<font color="#0080FF">{{rowObj["Date"]}}</font>
						节日名称：<font color="#0080FF">{{rowObj["Holiday"]}}</font> 
					</p></a>
			</li>
			{{/each}}
		</ul>
    </script>
</body>
</html>
